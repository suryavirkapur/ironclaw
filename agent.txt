current context:
- shared long-term memory is now backed by sqlite tables in the guest brain db path
  (`memories`, `summaries`, `memories_fts`)
- host planning now injects a memory block before conversation history and current user message
- memory retrieval uses fts5 candidate search with reranking by recency, importance, and pinned status
- telegram memory identity is global (`owner`) instead of chat-scoped user ids
- telegram transcripts still keep rolling 50-turn local history per chat session
- background summarization now runs every 20 user messages per session and writes to `summaries`
- summary distillation auto-upserts 1-3 durable fact memories when cadence triggers
- memory persistence redacts key-like secrets before storage
- guest runtime supports memory commands: `remember <text>`, `pins`, `forget <id or query>`

pending tasks:
- run websocket smoke scripts on a host where tcp bind is permitted
- run manual telegram dm e2e with real bot credentials in firecracker mode
- validate shared user identity behavior once whatsapp channel is added

important decisions:
- used existing sqlite guest brain db layout and extended schema instead of a separate memory store
- implemented no-embedding design using only fts5 + deterministic rerank
- kept memory command surface minimal and channel-agnostic
- used summary cadence keyed by session turn range (`<session>:<start>-<end>`) to avoid duplicates

architectural notes:
- memory prompt budget is clamped to ~2k-4k chars (target 3200)
- planner prompt ordering is now: memory block, conversation history, current message
- memory fts index is rebuilt on memory writes/forgets to keep content-linked fts in sync
- telegram owner channel now writes memories under `users_root/owner/guest/db/ironclaw.db`

plan:
- add channel adapters to emit the same global owner user id for future whatsapp integration
- tune fact distillation heuristics with real transcript samples if false positives appear
